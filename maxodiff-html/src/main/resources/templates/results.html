<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}"/>
<head>
    <meta charset="UTF-8">
    <title>Thymeleaf maxodiff analysis</title>
</head>
<body>
<form th:action="@{/results}">
    <table class="liricalSummaryTable" th:object="${liricalRecord}">
        <thead>
        <tr>
            <th colspan="4">LIRICAL Calculation Parameters</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Genome Build:</td><td th:text="*{genomeBuild}"></td>
            <td>Transcript Database:</td><td th:text="*{transcriptDatabase}"></td>
        </tr>
        <tr>
            <td>Pathogenicity Threshold:</td><td th:text="*{pathogenicityThreshold}"></td>
            <td>Default Variant Background Frequency:</td><td th:text="*{defaultVariantBackgroundFrequency}"></td>
        </tr>
        <tr>
            <td>Strict:</td><td th:text="*{strict}"></td>
            <td>Global Mode:</td><td th:text="*{globalAnalysisMode}"></td>
        </tr>
        <tr>
            <td>Exomiser Database File:</td><td th:text="*{exomiserPath}"></td>
            <td>VCF File:</td><td th:text="*{vcfPath}"></td>
        </tr>
        </tbody>
    </table>

    <p></p>
    <table>
        <tbody>
        <tr>
            <td style='font-weight:bold;'>Phenopacket Path:</td><td th:text="${inputRecord.phenopacketPath}"></td>
        </tr>
        </tbody>
    </table>

    <h1>Differential Diagnosis Calculation:</h1>
    <table class="diffDiagInputTable">
        <tbody>
        <tr>
            <td>Posttest Probability Threshold:</td>
            <td><input style="width:90%" type="number" step="0.05" min="0" max="1" name="posttestFilter" /></td>
        </tr>
        <tr>
            <td>Weight: </td>
            <td><input style="width:90%" type="number" step="0.05" min="0" max="1" name="weight"/></td>
        </tr>
        <tr>
            <td>Maximum # MaXo Results to Display:</td>
            <td><input style="width:90%" type="number" min="1" name="nMaxoResults"/></td>
        </tr>
        </tbody>
    </table>

    <p><input type="submit" value="Run Differential Diagnosis Calculation" /></p>
</form>

<h1 th:text="'maxodiff Analysis Results for ' + ${phenopacket}"></h1>
<table>
    <tbody>
        <tr>
            <td style='font-weight:bold;'>Disease ID:</td><td th:text="${diseaseId}"></td>
        </tr>
        <tr>
            <td style='font-weight:bold;'>Posttest probability threshold:</td><td th:text="${posttestFilter}"></td>
        </tr>
        <tr>
            <td style='font-weight:bold;'>Weight:</td><td th:text="${weight}"></td>
        </tr>
    </tbody>
</table>

<h1 th:text="'Top ' + ${nDisplayed} + ' Recommended MaXo Terms'"></h1>

<th:block th:each= "maxoTable, iter : ${maxoTables}">
    <h2 th:text="${iter.index+1} + ') ' + ${maxoTable.key.maxoTerm} + ': ' + ${maxoTable.key.maxoLabel}"></h2>
    <table class="scoreTable">
        <tbody>
        <tr>
            <td>Score:</td><td th:text="${#numbers.formatDecimal(maxoTable.key.score, 0, 0)}"></td>
        </tr>
        <tr>
            <td>N Diseases:</td><td th:text="${maxoTable.key.nOmimTerms}"></td>
        </tr>
        </tbody>
    </table>

    <h3>Table of HPO Term Frequencies</h3>
    <table class='resultsTable'>
        <thead>
        <tr>
            <th></th>
            <th:block th:each="omimId : ${omimIds}">
                <th th:text="${omimId}"></th>
            </th:block>
        </tr>
        </thead>

        <tbody>
        <th:block th:each= "freqRecord : ${maxoTable.value}">
            <tr>
                <td th:text="${freqRecord.hpoId} + ' (' + ${freqRecord.hpoLabel} + ')'"></td>
                <th:block th:each="frequency : ${freqRecord.frequencies}">
                    <td th:text="${frequency}"></td>
                </th:block>
            </tr>
        </th:block>
        </tbody>
    </table>
</th:block>

<!--<table class='resultsTable'>-->
<!--    <thead>-->
<!--    <tr>-->
<!--        <th>Maxo Term</th>-->
<!--        <th>Maxo Label</th>-->
<!--        <th>Score</th>-->
<!--        <th>Top N Diseases</th>-->
<!--        <th>Disease Ids</th>-->
<!--        <th>HPO Terms</th>-->
<!--    </tr>-->
<!--    </thead>-->

<!--    <tbody>-->
<!--    <th:block th:each= "maxoRecord : ${maxoRecords}">-->
<!--        <tr>-->
<!--            <td th:text="${maxoRecord.maxoTerm}"></td>-->
<!--            <td th:text="${maxoRecord.maxoLabel}"></td>-->
<!--            <td th:text="${maxoRecord.score}"></td>-->
<!--            <td th:text="${maxoRecord.nOmimTerms}"></td>-->
<!--            <td th:text="${maxoRecord.omimTerms}"></td>-->
<!--            <td th:text="${maxoRecord.hpoTerms}"></td>-->
<!--        </tr>-->
<!--    </th:block>-->
<!--    </tbody>-->
<!--</table>-->

</body>
</html>

